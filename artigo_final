
# Assuming your data frame is named "yields"
# Make sure the column names are set appropriately

# Create an empty vector to store the optimal p for each time series
optimal_p_values <- numeric(121)

# Create an empty vector to store the variance of residuals for each time series
residual_variances <- numeric(121)

# Loop through each time series
for (i in 1:121) {
  time_series <- yields[, i]
  
  # Initialize variables to store minimum BIC and optimal p
  min_bic <- Inf
  optimal_p <- 0
  
  # Try AR models with different values of p
  for (p in 1:10) {  # You can adjust the range of p as needed
    arima_model <- arima(time_series, order = c(p, 0, 0))
    bic <- AIC(arima_model, k = log(length(time_series)))
    
    # Update optimal p if current model has lower BIC
    if (bic < min_bic) {
      min_bic <- bic
      optimal_p <- p
    }
  }
  
  # Fit the final AR model with the optimal p
  final_arima_model <- arima(time_series, order = c(optimal_p, 0, 0))
  
  # Collect the variance of residuals
  residual_variances[i] <- var(resid(final_arima_model))
  
  # Store the optimal p value
  optimal_p_values[i] <- optimal_p
}

# Display or use the results as needed
print(optimal_p_values)
print(residual_variances)
